<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitud de Jornada IPASME</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Georama:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <style>
        :root {
            --azul-oscuro: #004a99;
            --azul-claro: #e3f2fd;
            --verde-claro: #c8e6c9;
            --blanco: #ffffff;
            --error: #d32f2f;
        }

        body {
            font-family: 'Georama', sans-serif;
            background-color: var(--azul-claro);
            color: #333;
            display: flex;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background-color: var(--blanco);
            width: 100%;
            max-width: 800px;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        h1 { color: var(--azul-oscuro); text-align: center; border-bottom: 2px solid var(--verde-claro); padding-bottom: 10px; }
        
        .section { margin-bottom: 25px; padding: 15px; border-radius: 8px; border: 1px solid #eee; }
        .section-title { font-weight: 700; margin-bottom: 15px; color: var(--azul-oscuro); }
        .required { color: var(--error); }

        /* Botones de selección múltiple/única */
        .options-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .option-btn {
            padding: 10px 15px;
            border: 2px solid var(--azul-oscuro);
            background: var(--blanco);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Georama';
            font-weight: 500;
        }

        .option-btn.selected {
            background-color: var(--azul-oscuro);
            color: white;
        }

        .option-btn:hover { background-color: var(--verde-claro); color: black; }

        /* Input Styles */
        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-family: 'Georama';
        }

        .time-container { display: flex; align-items: center; gap: 10px; }
        .am-pm-btn {
            padding: 10px;
            border: 1px solid var(--azul-oscuro);
            background: white;
            cursor: pointer;
            border-radius: 5px;
        }
        .am-pm-btn.selected { background: var(--verde-claro); font-weight: bold; }

        /* Fotos */
        .photo-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            border: 2px dashed var(--azul-oscuro);
            padding: 10px;
            margin: 5px;
            flex: 1;
            min-width: 150px;
        }
        .preview {
            width: 100px;
            height: 100px;
            object-fit: cover;
            display: none;
            border-radius: 5px;
        }

        .warning-box {
            background-color: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        .submit-btn {
            background-color: var(--azul-oscuro);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 30px;
            font-size: 1.2rem;
            cursor: pointer;
            width: 100%;
            font-weight: 700;
        }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container">
    <h1>Solicitud de Jornada IPASME</h1>

    <div class="warning-box">
        ⚠️ IMPORTANTE: La solicitud debe realizarse con al menos 48 horas de anticipación.
    </div>

    <form action="https://formsubmit.co/flyersunidadesipasme@gmail.com" method="POST" enctype="multipart/form-data" id="mainForm">
        <input type="hidden" name="_subject" id="emailSubject" value="Nueva Solicitud de Jornada">
        <input type="hidden" name="_template" value="table">
        
        <div class="section">
            <div class="section-title">1. Tipo de Jornada <span class="required">*</span></div>
            <div class="options-grid" id="tipoJornada">
                <button type="button" class="option-btn" onclick="selectSingle(this, 'jornada_tipo')">Ipasme va a la Escuela</button>
                <button type="button" class="option-btn" onclick="selectSingle(this, 'jornada_tipo')">Jornada de Atención Médica Integral</button>
                <button type="button" class="option-btn" onclick="selectSingle(this, 'jornada_tipo')">Jornada Conjunta</button>
                <button type="button" class="option-btn" onclick="selectSingle(this, 'jornada_tipo')">Captación Quirúrgica</button>
                <button type="button" class="option-btn" onclick="selectSingle(this, 'jornada_tipo')">Otros</button>
            </div>
            <input type="hidden" name="Tipo de Jornada" id="input_jornada" required>
        </div>

        <div id="otros_container" class="section hidden">
            <div class="section-title">Describa su solicitud</div>
            <textarea name="Descripcion Otros" rows="5" placeholder="Escriba detalladamente su requerimiento..."></textarea>
        </div>

        <div class="section" id="section_especialidades">
            <div class="section-title" id="title_2">2. Especialidades <span class="required">*</span></div>
            <div class="options-grid" id="grid_especialidades">
                </div>
            <input type="hidden" name="Seleccion_Opcion_2" id="input_opcion_2">
        </div>

        <div class="section" id="section_servicios">
            <div class="section-title">3. Servicios Adicionales</div>
            <div class="options-grid" id="grid_servicios">
                </div>
            <input type="hidden" name="Servicios Adicionales" id="input_servicios">
        </div>

        <div class="section">
            <div class="section-title">4. Fecha y Hora <span class="required">*</span></div>
            <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                <div style="flex: 1;">
                    <label>Fecha:</label>
                    <input type="date" name="Fecha" id="fecha_solicitud" required style="width: 100%; padding: 10px;">
                </div>
                <div style="flex: 1;">
                    <label>Hora:</label>
                    <div class="time-container">
                        <input type="text" id="hora_input" placeholder="00:00" style="width: 80px;">
                        <button type="button" class="am-pm-btn" onclick="selectAMPM(this, 'AM')">a. m.</button>
                        <button type="button" class="am-pm-btn" onclick="selectAMPM(this, 'PM')">p. m.</button>
                    </div>
                    <input type="hidden" name="Hora Final" id="input_hora_completa">
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">5. Dirección <span class="required">*</span></div>
            <input type="text" name="Direccion" required>
        </div>

        <div class="section">
            <div class="section-title">6. Unidad <span class="required">*</span></div>
            <input type="text" name="Unidad" id="input_unidad" required oninput="updateSubject()">
        </div>

        <div class="section" style="display: flex; gap: 10px;">
            <div style="flex: 1;">
                <div class="section-title">7. Teléfono</div>
                <input type="text" name="Telefono">
            </div>
            <div style="flex: 1;">
                <div class="section-title">8. Correo Arte</div>
                <input type="text" name="Correo Arte">
            </div>
        </div>

        <div class="section">
            <div class="section-title">Adjuntar Fotos (Máx 3MB c/u)</div>
            <div style="display: flex; flex-wrap: wrap;">
                <div class="photo-upload">
                    <label>Foto 1</label>
                    <input type="file" name="Foto 1" accept="image/*" onchange="previewImg(this, 'p1')">
                    <img id="p1" class="preview">
                </div>
                <div class="photo-upload">
                    <label>Foto 2</label>
                    <input type="file" name="Foto 2" accept="image/*" onchange="previewImg(this, 'p2')">
                    <img id="p2" class="preview">
                </div>
                <div class="photo-upload">
                    <label>Foto 3</label>
                    <input type="file" name="Foto 3" accept="image/*" onchange="previewImg(this, 'p3')">
                    <img id="p3" class="preview">
                </div>
            </div>
        </div>

        <button type="submit" class="submit-btn">ENVIAR SOLICITUD</button>
    </form>
</div>

<script>
    const especialidades = ["Alergología", "Cardiología", "Cirugía general", "Dermatología", "Ecografía", "Fisiatría", "Gastroenterología", "Geriatría", "Gerontología", "Ginecología y obstetricia", "Medicina familiar", "Medicina general", "Medicina interna", "Nefrología", "Neumología", "Neurología", "Nutrición", "Odontología", "Oftalmología", "Oncología", "Optometría", "Pediatría", "Psicología", "Psiquiatría", "Reumatología", "Traumatología", "Urología"];
    
    const patologias = ["Hernia inguinal", "Hernia umbilical", "Hernia abdominal", "Hernia epigástrica", "Hernia escrotal", "Fimosis", "Vasectomía", "Varicocele", "Hidrocele", "Litiasis vesicular", "Colectomía", "Lipomas", "Quiste tirogloso", "Quiste sebáceo", "Esterilización", "Miomatosis uterina", "Tumores ováricos", "Prolapso", "Histerectomía", "Catarata", "Pterigión", "Glaucoma", "Retinoblastoma"];

    const servicios = ["Fisioterapia", "Inmunización", "Control de talla y peso", "Despistaje HTA", "Afiliación", "Sesión educativa", "Farmacia", "Captación quirúrgica general", "Captación quirúrgica oftalmológica", "Servicios sociales", "Masoterapia", "Terapia ocupacional", "Desparasitación", "Bienestar social"];

    let selectedAMPM = "";

    // Inicializar grids
    function buildGrid(items, gridId, inputId) {
        const grid = document.getElementById(gridId);
        grid.innerHTML = "";
        items.forEach(item => {
            const btn = document.createElement('button');
            btn.type = "button";
            btn.className = "option-btn";
            btn.innerText = item;
            btn.onclick = () => toggleMultiple(btn, inputId);
            grid.appendChild(btn);
        });
    }

    buildGrid(especialidades, 'grid_especialidades', 'input_opcion_2');
    buildGrid(servicios, 'grid_servicios', 'input_servicios');

    function selectSingle(btn, type) {
        const parent = btn.parentElement;
        parent.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        
        const val = btn.innerText;
        document.getElementById('input_jornada').value = val;
        updateSubject();

        // Lógica de visibilidad
        const sec2 = document.getElementById('section_especialidades');
        const sec3 = document.getElementById('section_servicios');
        const otros = document.getElementById('otros_container');

        if (val === "Captación Quirúrgica") {
            sec2.classList.remove('hidden');
            sec3.classList.add('hidden');
            otros.classList.add('hidden');
            document.getElementById('title_2').innerText = "2. Patologías *";
            buildGrid(patologias, 'grid_especialidades', 'input_opcion_2');
        } else if (val === "Otros") {
            sec2.classList.add('hidden');
            sec3.classList.add('hidden');
            otros.classList.remove('hidden');
        } else {
            sec2.classList.remove('hidden');
            sec3.classList.remove('hidden');
            otros.classList.add('hidden');
            document.getElementById('title_2').innerText = "2. Especialidades *";
            buildGrid(especialidades, 'grid_especialidades', 'input_opcion_2');
        }
    }

    function toggleMultiple(btn, inputId) {
        btn.classList.toggle('selected');
        const parent = btn.parentElement;
        const selected = Array.from(parent.querySelectorAll('.option-btn.selected')).map(b => b.innerText);
        
        // Regla especial de Captación Quirúrgica General y Oftalmológica
        let processedList = [...selected];
        if (selected.includes("Captación quirúrgica general") && selected.includes("Captación quirúrgica oftalmológica")) {
            processedList = processedList.filter(i => !i.includes("Captación quirúrgica"));
            processedList.push("Captación quirúrgica general y oftalmológica");
        }

        document.getElementById(inputId).value = processedList.join('\n• ');
    }

    function selectAMPM(btn, val) {
        document.querySelectorAll('.am-pm-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        selectedAMPM = val;
        updateTime();
    }

    function updateTime() {
        const hora = document.getElementById('hora_input').value;
        document.getElementById('input_hora_completa').value = `${hora} ${selectedAMPM}`;
    }

    function previewImg(input, previewId) {
        const file = input.files[0];
        if (file && file.size > 3 * 1024 * 1024) {
            alert("El archivo supera los 3MB");
            input.value = "";
            return;
        }
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = document.getElementById(previewId);
                img.src = e.target.result;
                img.style.display = "block";
            };
            reader.readAsDataURL(file);
        }
    }

    function updateSubject() {
        const unidad = document.getElementById('input_unidad').value;
        const jornada = document.getElementById('input_jornada').value;
        document.getElementById('emailSubject').value = `Solicitud: ${unidad} - ${jornada}`;
    }

    document.getElementById('mainForm').onsubmit = function(e) {
        // Validar 48 horas
        const fechaInput = document.getElementById('fecha_solicitud').value;
        const fechaSoli = new Date(fechaInput);
        const hoy = new Date();
        const diff = (fechaSoli - hoy) / (1000 * 60 * 60);

        if (diff < 48) {
            alert("Error: La solicitud debe ser con al menos 48 horas de anticipación.");
            e.preventDefault();
            return false;
        }

        // Validar Especialidad/Patología si no es "Otros"
        const jornada = document.getElementById('input_jornada').value;
        if (jornada !== "Otros" && !document.getElementById('input_opcion_2').value) {
            alert("Debe seleccionar al menos una especialidad o patología.");
            e.preventDefault();
            return false;
        }

        updateTime();
        if (!confirm("⚠️ Verifique que la dirección esté correcta. Si la dirección es incorrecta, la solicitud será dejada de última en la lista. ¿Desea continuar?")) {
            e.preventDefault();
        }
    };
</script>

</body>
</html>
