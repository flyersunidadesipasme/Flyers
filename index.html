<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitud de Jornada IPASME</title>
    <style>
        :root {
            --azul-oscuro: #1e3a8a;
            --azul-medio: #3b82f6;
            --verde-claro: #d1fae5;
            --verde-fuerte: #10b981;
            --blanco: #ffffff;
            --gris-suave: #f3f4f6;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--gris-suave);
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--blanco);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-top: 8px solid var(--azul-oscuro);
        }

        h1 { color: var(--azul-oscuro); text-align: center; margin-bottom: 5px; }
        .aviso { 
            background-color: #fee2e2; 
            color: #b91c1c; 
            padding: 10px; 
            border-radius: 5px; 
            text-align: center; 
            font-weight: bold;
            margin-bottom: 20px;
            border: 1px solid #f87171;
        }

        section { margin-bottom: 25px; padding: 15px; border: 1px solid #e5e7eb; border-radius: 8px; }
        h3 { color: var(--azul-medio); margin-top: 0; border-bottom: 2px solid var(--verde-claro); padding-bottom: 5px; }

        .grid-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        /* Estilo para botones de opción (Checkboxes ocultos) */
        .option-btn {
            position: relative;
        }

        .option-btn input[type="checkbox"], .option-btn input[type="radio"] {
            display: none;
        }

        .option-btn label {
            display: block;
            background: var(--blanco);
            border: 2px solid var(--azul-medio);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
            font-size: 0.9em;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .option-btn input:checked + label {
            background: var(--verde-fuerte);
            color: white;
            border-color: var(--verde-fuerte);
        }

        input[type="text"], input[type="date"], input[type="time"], textarea, input[type="email"] {
            width: 100%;
            padding: 12px;
            margin-top: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }

        .hidden { display: none; }

        .preview-container {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .preview-container img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 5px;
            border: 2px solid var(--azul-medio);
        }

        button[type="submit"] {
            background-color: var(--azul-oscuro);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            font-size: 1.1em;
            font-weight: bold;
            transition: 0.3s;
        }

        button[type="submit"]:hover { background-color: var(--azul-medio); }
    </style>
</head>
<body>

<div class="container">
    <h1>Solicitud de Jornada Institucional</h1>
    <p class="aviso">⚠️ ATENCIÓN: La solicitud NO procederá a menos que tenga un mínimo de 48 horas de anticipación.</p>

    <form id="jornadaForm" action="https://formsubmit.co/flyersunidadesipasme@gmail.com" method="POST" enctype="multipart/form-data">
        
        <input type="hidden" name="_subject" id="emailSubject" value="Nueva Solicitud de Jornada">
        <input type="hidden" name="_template" value="table">
        <input type="hidden" name="_next" value="https://tu-sitio-web.com/gracias.html"> <section>
            <h3>6. Unidad Solicitante</h3>
            <input type="text" name="Unidad" id="unidadInput" placeholder="Nombre de la unidad" required oninput="updateSubject()">
        </section>

        <section>
            <h3>1. Tipo de Jornada</h3>
            <div class="grid-options">
                <div class="option-btn">
                    <input type="radio" name="Tipo_Jornada" value="Ipasme va a la Escuela" id="j1" required onclick="toggleFields(this.value)">
                    <label for="j1">Ipasme va a la Escuela</label>
                </div>
                <div class="option-btn">
                    <input type="radio" name="Tipo_Jornada" value="Jornada de Atención Médica Integral" id="j2" onclick="toggleFields(this.value)">
                    <label for="j2">Jornada de Atención Médica Integral</label>
                </div>
                <div class="option-btn">
                    <input type="radio" name="Tipo_Jornada" value="Jornada Conjunta" id="j3" onclick="toggleFields(this.value)">
                    <label for="j3">Jornada Conjunta</label>
                </div>
                <div class="option-btn">
                    <input type="radio" name="Tipo_Jornada" value="Captación Quirúrgica" id="j4" onclick="toggleFields(this.value)">
                    <label for="j4">Captación Quirúrgica</label>
                </div>
                <div class="option-btn">
                    <input type="radio" name="Tipo_Jornada" value="Otros" id="j5" onclick="toggleFields(this.value)">
                    <label for="j5">Otros</label>
                </div>
            </div>
        </section>

        <section id="sec-2">
            <h3 id="titulo-sec-2">2. Especialidades</h3>
            <div id="lista-especialidades" class="grid-options">
                </div>
            <div id="lista-patologias" class="grid-options hidden">
                </div>
        </section>

        <section id="sec-3">
            <h3>3. Servicios Adicionales</h3>
            <div id="lista-servicios" class="grid-options">
                </div>
        </section>

        <section id="sec-otros" class="hidden">
            <h3>Describa su solicitud</h3>
            <textarea name="Descripcion_Otros" rows="5" placeholder="Escriba aquí los detalles de su solicitud..."></textarea>
        </section>

        <section>
            <h3>4. Fecha y Hora</h3>
            <div style="display: flex; gap: 10px;">
                <div style="flex:1">
                    <label>Fecha:</label>
                    <input type="date" name="Fecha_Evento" id="fechaEvento" required onchange="validar48Horas()">
                </div>
                <div style="flex:1">
                    <label>Hora:</label>
                    <input type="time" name="Hora_Evento" required>
                </div>
            </div>
            <p id="error-fecha" style="color: red; font-size: 0.8em; margin-top: 5px; display: none;">* La fecha debe tener al menos 48 horas de anticipación.</p>
        </section>

        <section>
            <h3>5. Dirección</h3>
            <input type="text" name="Direccion" placeholder="Dirección completa" required>
        </section>

        <section>
            <div style="display: flex; gap: 10px;">
                <div style="flex:1">
                    <h3>7. Teléfono</h3>
                    <input type="text" name="Telefono" placeholder="Ej: 04121234567" required>
                </div>
                <div style="flex:1">
                    <h3>8. Correo (para el arte)</h3>
                    <input type="email" name="Email_Arte" placeholder="ejemplo@correo.com" required>
                </div>
            </div>
        </section>

        <section>
            <h3>Carga de Imágenes (Máx 2, 3MB c/u)</h3>
            <input type="file" name="adjuntos" id="fotos" accept="image/*" multiple onchange="handleFiles(this.files)">
            <div class="preview-container" id="preview"></div>
        </section>

        <button type="submit" id="btnEnviar">ENVIAR SOLICITUD</button>
    </form>
</div>

<script>
    const especialidades = ["Alergología", "Cardiología", "Cirugía general", "Dermatología", "Ecografía", "Fisiatría", "Gastroenterología", "Geriatría", "Gerontología", "Ginecología y obstetricia", "Medicina familiar", "Medicina general", "Medicina interna", "Nefrología", "Neumología", "Neurología", "Nutrición", "Odontología", "Oftalmología", "Oncología", "Optometría", "Pediatría", "Psicología", "Psiquiatría", "Reumatología", "Traumatología", "Urología"];
    
    const patologias = ["Hernia inguinal", "Hernia umbilical", "Hernia abdominal", "Hernia epigástrica", "Hernia escrotal", "Fimosis", "Vasectomía", "Varicocele", "Hidrocele", "Litiasis vesicular", "Colectomía", "Lipomas", "Quiste tirogloso", "Quiste sebáceo", "Esterilización", "Miomatosis uterina", "Tumores ováricos", "Prolapso", "Histerectomía", "Catarata", "Pterigión", "Glaucoma", "Retinoblastoma"];

    const servicios = ["Fisioterapia", "Inmunización", "Control de talla y peso", "Despistaje HTA", "Afiliación", "Sesión educativa", "Farmacia", "Captación quirúrgica general", "Captación quirúrgica oftalmológica", "Servicios sociales", "Masoterapia", "Terapia ocupacional", "Desparasitación", "Bienestar social"];

    // Cargar opciones en el DOM
    function cargarOpciones(lista, containerId, name, type="checkbox") {
        const container = document.getElementById(containerId);
        lista.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'option-btn';
            div.innerHTML = `
                <input type="${type}" name="${name}" value="${item}" id="${name + index}">
                <label for="${name + index}">${item}</label>
            `;
            container.appendChild(div);
        });
    }

    cargarOpciones(especialidades, 'lista-especialidades', 'Especialidades[]');
    cargarOpciones(patologias, 'lista-patologias', 'Patologias[]');
    cargarOpciones(servicios, 'lista-servicios', 'Servicios[]');

    function toggleFields(valor) {
        const sec2 = document.getElementById('sec-2');
        const sec3 = document.getElementById('sec-3');
        const secOtros = document.getElementById('sec-otros');
        const tituloSec2 = document.getElementById('titulo-sec-2');
        const listaEsp = document.getElementById('lista-especialidades');
        const listaPat = document.getElementById('lista-patologias');

        updateSubject();

        // Reset
        sec2.classList.remove('hidden');
        sec3.classList.remove('hidden');
        secOtros.classList.add('hidden');
        listaEsp.classList.add('hidden');
        listaPat.classList.add('hidden');

        if (valor === "Captación Quirúrgica") {
            tituloSec2.innerText = "2. Patologías";
            listaPat.classList.remove('hidden');
            sec3.classList.add('hidden');
        } else if (valor === "Otros") {
            sec2.classList.add('hidden');
            sec3.classList.add('hidden');
            secOtros.classList.remove('hidden');
        } else {
            tituloSec2.innerText = "2. Especialidades";
            listaEsp.classList.remove('hidden');
        }
    }

    function updateSubject() {
        const unidad = document.getElementById('unidadInput').value;
        const jornada = document.querySelector('input[name="Tipo_Jornada"]:checked')?.value || "";
        document.getElementById('emailSubject').value = `Solicitud: ${unidad} - ${jornada}`;
    }

    function validar48Horas() {
        const fechaInput = document.getElementById('fechaEvento').value;
        const btn = document.getElementById('btnEnviar');
        const error = document.getElementById('error-fecha');
        
        if (!fechaInput) return;

        const hoy = new Date();
        const fechaElegida = new Date(fechaInput + "T00:00:00");
        const diffHoras = (fechaElegida - hoy) / (1000 * 60 * 60);

        if (diffHoras < 48) {
            error.style.display = "block";
            btn.disabled = true;
            btn.style.opacity = "0.5";
        } else {
            error.style.display = "none";
            btn.disabled = false;
            btn.style.opacity = "1";
        }
    }

    function handleFiles(files) {
        const preview = document.getElementById('preview');
        preview.innerHTML = "";
        
        if (files.length > 2) {
            alert("Máximo 2 archivos");
            document.getElementById('fotos').value = "";
            return;
        }

        for (const file of files) {
            if (file.size > 3 * 1024 * 1024) {
                alert(`El archivo ${file.name} excede los 3MB`);
                document.getElementById('fotos').value = "";
                preview.innerHTML = "";
                return;
            }
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = document.createElement('img');
                img.src = e.target.result;
                preview.appendChild(img);
            }
            reader.readAsDataURL(file);
        }
    }

    // Lógica especial para envío de servicios combinados
    document.getElementById('jornadaForm').onsubmit = function() {
        const capsGen = document.querySelector('input[value="Captación quirúrgica general"]');
        const capsOft = document.querySelector('input[value="Captación quirúrgica oftalmológica"]');
        
        if (capsGen?.checked && capsOft?.checked) {
            // Creamos un campo oculto temporal para el envío formateado
            const hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.name = 'Servicio_Especial';
            hiddenInput.value = 'Captación quirúrgica general y oftalmológica';
            this.appendChild(hiddenInput);
        }
    };
</script>

</body>
</html>
